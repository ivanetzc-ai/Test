<!doctype html>

<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>WebOTP ‚Äî –ª–æ–≤–∏–º–æ –≤—Å—ñ —Ñ–æ—Ä–º–∞—Ç–∏</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;margin:20px;background:#f7f9fc;color:#0b1220}
  .card{background:#fff;border-radius:12px;padding:18px;box-shadow:0 6px 18px rgba(12,20,40,0.06);max-width:820px;margin:12px auto}
  input,textarea,button{font:inherit}
  #otp{font-size:18px;padding:10px;border-radius:8px;border:1px solid #e3e8ef;width:100%;box-sizing:border-box}
  button{padding:10px 14px;border-radius:8px;border:none;background:#2563eb;color:#fff;cursor:pointer}
  .hint{color:#556; font-size:13px}
  .candidates{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap}
  .chip{background:#eef4ff;padding:8px 10px;border-radius:999px;border:1px solid #d6e6ff;cursor:pointer}
  .small{font-size:13px;color:#445}
  textarea{width:100%;min-height:80px;padding:10px;border-radius:8px;border:1px solid #e3e8ef}
</style>
</head>
<body>
  <div class="card">
    <h2>WebOTP ‚Äî –ª–æ–≤–∏–º–æ –≤—Å—ñ —Ñ–æ—Ä–º–∞—Ç–∏</h2>
    <p class="hint">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å <strong>–ó–∞–ø–∏—Ç–∞—Ç–∏ OTP</strong>. –Ø–∫—â–æ WebOTP –Ω–µ –∑–ª–æ–≤–∏—Ç—å –∫–æ–¥, –≤—Å—Ç–∞–≤—Ç–µ —Å—é–¥–∏ —Ç–µ–∫—Å—Ç SMS ‚Äî –∞–ª–≥–æ—Ä–∏—Ç–º —Å–ø—Ä–æ–±—É—î –≤–∏—Ç—è–≥—Ç–∏ –≤—Å—ñ –º–æ–∂–ª–∏–≤—ñ –∫–æ–¥–∏.</p><label class="small" for="otp">–ü–æ–ª–µ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è</label>
<input id="otp" placeholder="–¢—É—Ç –∑'—è–≤–∏—Ç—å—Å—è –∫–æ–¥" autocomplete="one-time-code">
<div style="height:10px"></div>

<div style="display:flex;gap:8px;align-items:center">
  <button id="getOTP">–ó–∞–ø–∏—Ç–∞—Ç–∏ OTP</button>
  <button id="abort" style="background:#eaeef5;color:#1f2937">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
  <div style="flex:1"></div>
  <div class="small">–¢–∞–π–º–∞—É—Ç: <span id="timeoutLabel">90</span>s</div>
</div>

<p id="status" class="hint"></p>

<hr style="margin:14px 0;border:none;border-top:1px solid #eef2f7">

<label class="small" for="paste">–í—Å—Ç–∞–≤–∏—Ç–∏ —Ç–µ–∫—Å—Ç SMS (—Ñ–æ–ª–±–µ–∫)</label>
<textarea id="paste" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: \n–ü—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å –∑–º—ñ–Ω—É –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω—Éüì±\n–ü–∞—Ä–æ–ª—å: 29-12 5HQ2gASfW+6\n –∞–±–æ \n<#> –ö–æ–¥: 05-68"></textarea>
<div style="height:8px"></div>
<button id="parse">–ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ SMS</button>

<div class="candidates" id="candidates"></div>

<p class="hint">–ü—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ —Ñ–æ—Ä–º–∞—Ç–∏ (–ø—Ä–∏–∫–ª–∞–¥–∏): <code>123456</code>, <code>05-68</code>, <code>29-12</code>, <code>5HQ2gASfW+6</code>, <code>@site.com #123456</code>, <code>–ü–∞—Ä–æ–ª—å: ...</code></p>

  </div><script>
const getBtn = document.getElementById('getOTP');
const abortBtn = document.getElementById('abort');
const status = document.getElementById('status');
const otpInput = document.getElementById('otp');
const pasteArea = document.getElementById('paste');
const parseBtn = document.getElementById('parse');
const candidatesDiv = document.getElementById('candidates');
const timeoutLabel = document.getElementById('timeoutLabel');

let controller = null;
let TIMEOUT = 90;
timeoutLabel.textContent = TIMEOUT;

function unique(arr){ return [...new Set(arr)]; }

function extractCodes(text){
  if(!text) return [];
  const found = [];
  const labelled = text.match(/(?:–ö–æ–¥|–∫–æ–¥|–ü–∞—Ä–æ–ª—å|–ø–∞—Ä–æ–ª—å|Code|code|OTP|otp)[:\s]*([A-Za-z0-9\-+]{2,20})/g);
  if(labelled){ labelled.forEach(l =>{
    const m = l.match(/(?:–ö–æ–¥|–∫–æ–¥|–ü–∞—Ä–æ–ª—å|–ø–∞—Ä–æ–ª—å|Code|code|OTP|otp)[:\s]*([A-Za-z0-9\-+]{2,20})/i);
    if(m && m[1]) found.push(m[1]);
  })}

  const atDomain = text.match(/@[^\s#]{1,40}\s*#\s*([A-Za-z0-9\-+]{2,30})/g);
  if(atDomain){ atDomain.forEach(a =>{ const m=a.match(/#\s*([A-Za-z0-9\-+]{2,30})/); if(m) found.push(m[1]); })}

  const nums = text.match(/\b\d{3,8}\b/g);
  if(nums) found.push(...nums);

  const hyph = text.match(/\b\d{1,3}-\d{1,3}\b/g);
  if(hyph) found.push(...hyph);

  const alnum = text.match(/\b[A-Za-z0-9+\-]{4,18}\b/g);
  if(alnum) found.push(...alnum);

  const lines = text.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
  lines.forEach(l =>{ if(/^[A-Za-z0-9+\-]{3,20}$/.test(l)) found.push(l); })

  const filtered = unique(found).filter(t => !/^(–ó–∞—Ö–æ–¥—å—Ç–µ|–±—É–¥—å –ª–∞—Å–∫–∞|Monobank|–í–∞—à|–ü—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å)$/i.test(t));

  filtered.sort((a,b)=>{
    function score(x){ if(/^\d{4,6}$/.test(x)) return 100; if(/\d+-\d+/.test(x)) return 80; if(/^[A-Za-z0-9+\-]{6,16}$/.test(x)) return 60; if(/^\d{3,8}$/.test(x)) return 50; return 10; }
    return score(b)-score(a);
  });

  return filtered;
}

function renderCandidates(list){
  candidatesDiv.innerHTML = '';
  if(!list || list.length===0){ candidatesDiv.innerHTML = '<div class="small hint">–ö–æ–¥—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</div>'; return; }
  list.forEach(code=>{
    const el = document.createElement('div');
    el.className = 'chip';
    el.textContent = code;
    el.title = '–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å —â–æ–± –≤—Å—Ç–∞–≤–∏—Ç–∏';
    el.addEventListener('click', ()=>{ otpInput.value = code; status.textContent = '–ö–æ–¥ –≤—Å—Ç–∞–≤–ª–µ–Ω–æ'; });
    candidatesDiv.appendChild(el);
  });
}

parseBtn.addEventListener('click', ()=>{
  const txt = pasteArea.value || '';
  const codes = extractCodes(txt);
  renderCandidates(codes);
  if(codes.length) status.textContent = `–ó–Ω–∞–π–¥–µ–Ω–æ ${codes.length} –∫–∞–Ω–¥–∏–¥–∞—Ç(—ñ–≤)`; else status.textContent = '–ö–∞–Ω–¥–∏–¥–∞—Ç—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ';
});

getBtn.addEventListener('click', async ()=>{
  status.textContent = '–Ü–Ω—ñ—Ü—ñ—é—î–º–æ WebOTP... –ë—Ä–∞—É–∑–µ—Ä —á–µ–∫–∞—î SMS.';
  otpInput.value = '';

  if(!('OTPCredential' in window)){
    status.textContent = 'WebOTP –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è —Ü–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º ‚Äî —Å–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ—Å—è —Ñ–æ–ª–±–µ–∫–æ–º (–≤—Å—Ç–∞–≤—Ç–µ SMS).';
    return;
  }

  controller = new AbortController();
  const signal = controller.signal;
  const timeoutId = setTimeout(()=>{ if(controller) controller.abort(); }, TIMEOUT*1000);

  try{
    const credential = await navigator.credentials.get({ otp: { transport: ['sms'] }, signal });
    clearTimeout(timeoutId);
    if(credential && credential.code){
      const raw = credential.code.toString();
      status.textContent = '–û—Ç—Ä–∏–º–∞–Ω–æ –¥–∞–Ω—ñ –≤—ñ–¥ WebOTP. –í–∏–∫–æ–Ω—É—î–º–æ –ø–∞—Ä—Å–∏–Ω–≥...';
      const candidates = extractCodes(raw);
      if(candidates.length){
        renderCandidates(candidates);
        otpInput.value = candidates[0];
        status.textContent = '–ö–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ.';
      } else {
        otpInput.value = raw;
        status.textContent = '–û—Ç—Ä–∏–º–∞–Ω–æ —Ä—è–¥–æ–∫, –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –Ω–µ —Å–ø—Ä–∞—Ü—é–≤–∞–ª–æ.';
      }
    }
  } catch(e){
    clearTimeout(timeoutId);
    status.textContent = 'WebOTP –Ω–µ –æ—Ç—Ä–∏–º–∞–≤ SMS –∞–±–æ —Å—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞.';
    console.error(e);
  }
});

abortBtn.addEventListener('click', ()=>{
  if(controller) controller.abort();
  status.textContent = '–ó–∞–ø–∏—Ç WebOTP —Å–∫–∞—Å–æ–≤–∞–Ω–æ';
});
</script></body>
  </html>
